from matplotlib.pyplot import title
import yfinance as yf
from io import BytesIO

import base64
from matplotlib.figure import Figure

import matplotlib.pylab as plt

class symbolController():
    def __init__(self, symbol='MSFT'):
        self.symbol = symbol

    def getsymbolInfo(self):
         try:
            df = yf.Ticker(self.symbol)
            dfx = df.get_info()
            return {'data': dfx, 'status': 200, 'message': f'symbol {self.symbol}'}
         except:
            return 'Error'

    def getsymbolChart(self):
        try:
            plt.switch_backend('agg')
            df = yf.Ticker(self.symbol)
            fig = df.history(periods='1y', frequency='1').Open.plot(figsize=(16, 10), color='blue', title=f'{self.symbol} Chart', ylabel='Price U$').get_figure()
            buf = BytesIO()
            fig.savefig(buf, format="png")
            data = base64.b64encode(buf.getbuffer()).decode("ascii")
            return data       
        except:
            return 'Error'

    def getsymbolDataFrame(self):
        try:
            sym = yf.Ticker(self.symbol)
            df = sym.history(period='max')
            return df
        except:
            return 'Error'

# Generated by https://quicktype.io

from typing import List, Any


class symbolType:
    the_52_week_change: float
    sand_p52_week_change: float
    address1: str
    algorithm: None
    annual_holdings_turnover: None
    annual_report_expense_ratio: None
    ask: float
    ask_size: int
    average_daily_volume10_day: int
    average_volume: int
    average_volume10_days: int
    beta: float
    beta3_year: None
    bid: float
    bid_size: int
    book_value: float
    category: None
    circulating_supply: None
    city: str
    company_officers: List[Any]
    country: str
    currency: str
    current_price: float
    current_ratio: float
    date_short_interest: int
    day_high: float
    day_low: float
    debt_to_equity: float
    dividend_rate: float
    dividend_yield: float
    earnings_growth: float
    earnings_quarterly_growth: float
    ebitda: int
    ebitda_margins: float
    enterprise_to_ebitda: float
    enterprise_to_revenue: float
    enterprise_value: int
    ex_dividend_date: int
    exchange: str
    exchange_timezone_name: str
    exchange_timezone_short_name: str
    expire_date: None
    fifty_day_average: float
    fifty_two_week_high: float
    fifty_two_week_low: float
    financial_currency: str
    five_year_average_return: None
    five_year_avg_dividend_yield: float
    float_shares: int
    forward_eps: float
    forward_pe: float
    free_cashflow: int
    from_currency: None
    full_time_employees: int
    fund_family: None
    fund_inception_date: None
    gmt_off_set_milliseconds: int
    gross_margins: float
    gross_profits: int
    held_percent_insiders: float
    held_percent_institutions: float
    implied_shares_outstanding: None
    industry: str
    is_esg_populated: bool
    last_cap_gain: None
    last_dividend_date: int
    last_dividend_value: float
    last_fiscal_year_end: int
    last_market: None
    last_split_date: int
    last_split_factor: str
    legal_type: None
    logo_url: str
    long_business_summary: str
    long_name: str
    market: str
    market_cap: int
    max_age: int
    max_supply: None
    message_board_id: str
    morning_star_overall_rating: None
    morning_star_risk_rating: None
    most_recent_quarter: int
    nav_price: None
    net_income_to_common: int
    next_fiscal_year_end: int
    number_of_analyst_opinions: int
    open: float
    open_interest: None
    operating_cashflow: int
    operating_margins: float
    payout_ratio: float
    peg_ratio: float
    phone: str
    previous_close: float
    price_hint: int
    price_to_book: float
    price_to_sales_trailing12_months: float
    profit_margins: float
    quick_ratio: float
    quote_type: str
    recommendation_key: str
    recommendation_mean: float
    regular_market_day_high: float
    regular_market_day_low: float
    regular_market_open: float
    regular_market_previous_close: float
    regular_market_price: float
    regular_market_volume: int
    return_on_assets: float
    return_on_equity: float
    revenue_growth: float
    revenue_per_share: float
    revenue_quarterly_growth: None
    sector: str
    shares_outstanding: int
    shares_percent_shares_out: float
    shares_short: int
    shares_short_previous_month_date: int
    shares_short_prior_month: int
    short_name: str
    short_percent_of_float: float
    short_ratio: float
    start_date: None
    state: str
    strike_price: None
    symbol: str
    target_high_price: int
    target_low_price: float
    target_mean_price: float
    target_median_price: int
    three_year_average_return: None
    to_currency: None
    total_assets: None
    total_cash: int
    total_cash_per_share: float
    total_debt: int
    total_revenue: int
    tradeable: bool
    trailing_annual_dividend_rate: float
    trailing_annual_dividend_yield: float
    trailing_eps: float
    trailing_pe: float
    two_hundred_day_average: float
    volume: int
    volume24_hr: None
    volume_all_currencies: None
    website: str
    symbol_yield: None
    ytd_return: None
    zip: str

    def __init__(self, the_52_week_change: float, sand_p52_week_change: float, address1: str, algorithm: None, annual_holdings_turnover: None, annual_report_expense_ratio: None, ask: float, ask_size: int, average_daily_volume10_day: int, average_volume: int, average_volume10_days: int, beta: float, beta3_year: None, bid: float, bid_size: int, book_value: float, category: None, circulating_supply: None, city: str, company_officers: List[Any], country: str, currency: str, current_price: float, current_ratio: float, date_short_interest: int, day_high: float, day_low: float, debt_to_equity: float, dividend_rate: float, dividend_yield: float, earnings_growth: float, earnings_quarterly_growth: float, ebitda: int, ebitda_margins: float, enterprise_to_ebitda: float, enterprise_to_revenue: float, enterprise_value: int, ex_dividend_date: int, exchange: str, exchange_timezone_name: str, exchange_timezone_short_name: str, expire_date: None, fifty_day_average: float, fifty_two_week_high: float, fifty_two_week_low: float, financial_currency: str, five_year_average_return: None, five_year_avg_dividend_yield: float, float_shares: int, forward_eps: float, forward_pe: float, free_cashflow: int, from_currency: None, full_time_employees: int, fund_family: None, fund_inception_date: None, gmt_off_set_milliseconds: int, gross_margins: float, gross_profits: int, held_percent_insiders: float, held_percent_institutions: float, implied_shares_outstanding: None, industry: str, is_esg_populated: bool, last_cap_gain: None, last_dividend_date: int, last_dividend_value: float, last_fiscal_year_end: int, last_market: None, last_split_date: int, last_split_factor: str, legal_type: None, logo_url: str, long_business_summary: str, long_name: str, market: str, market_cap: int, max_age: int, max_supply: None, message_board_id: str, morning_star_overall_rating: None, morning_star_risk_rating: None, most_recent_quarter: int, nav_price: None, net_income_to_common: int, next_fiscal_year_end: int, number_of_analyst_opinions: int, open: float, open_interest: None, operating_cashflow: int, operating_margins: float, payout_ratio: float, peg_ratio: float, phone: str, previous_close: float, price_hint: int, price_to_book: float, price_to_sales_trailing12_months: float, profit_margins: float, quick_ratio: float, quote_type: str, recommendation_key: str, recommendation_mean: float, regular_market_day_high: float, regular_market_day_low: float, regular_market_open: float, regular_market_previous_close: float, regular_market_price: float, regular_market_volume: int, return_on_assets: float, return_on_equity: float, revenue_growth: float, revenue_per_share: float, revenue_quarterly_growth: None, sector: str, shares_outstanding: int, shares_percent_shares_out: float, shares_short: int, shares_short_previous_month_date: int, shares_short_prior_month: int, short_name: str, short_percent_of_float: float, short_ratio: float, start_date: None, state: str, strike_price: None, symbol: str, target_high_price: int, target_low_price: float, target_mean_price: float, target_median_price: int, three_year_average_return: None, to_currency: None, total_assets: None, total_cash: int, total_cash_per_share: float, total_debt: int, total_revenue: int, tradeable: bool, trailing_annual_dividend_rate: float, trailing_annual_dividend_yield: float, trailing_eps: float, trailing_pe: float, two_hundred_day_average: float, volume: int, volume24_hr: None, volume_all_currencies: None, website: str, symbol_yield: None, ytd_return: None, zip: str) -> None:
        self.the_52_week_change = the_52_week_change
        self.sand_p52_week_change = sand_p52_week_change
        self.address1 = address1
        self.algorithm = algorithm
        self.annual_holdings_turnover = annual_holdings_turnover
        self.annual_report_expense_ratio = annual_report_expense_ratio
        self.ask = ask
        self.ask_size = ask_size
        self.average_daily_volume10_day = average_daily_volume10_day
        self.average_volume = average_volume
        self.average_volume10_days = average_volume10_days
        self.beta = beta
        self.beta3_year = beta3_year
        self.bid = bid
        self.bid_size = bid_size
        self.book_value = book_value
        self.category = category
        self.circulating_supply = circulating_supply
        self.city = city
        self.company_officers = company_officers
        self.country = country
        self.currency = currency
        self.current_price = current_price
        self.current_ratio = current_ratio
        self.date_short_interest = date_short_interest
        self.day_high = day_high
        self.day_low = day_low
        self.debt_to_equity = debt_to_equity
        self.dividend_rate = dividend_rate
        self.dividend_yield = dividend_yield
        self.earnings_growth = earnings_growth
        self.earnings_quarterly_growth = earnings_quarterly_growth
        self.ebitda = ebitda
        self.ebitda_margins = ebitda_margins
        self.enterprise_to_ebitda = enterprise_to_ebitda
        self.enterprise_to_revenue = enterprise_to_revenue
        self.enterprise_value = enterprise_value
        self.ex_dividend_date = ex_dividend_date
        self.exchange = exchange
        self.exchange_timezone_name = exchange_timezone_name
        self.exchange_timezone_short_name = exchange_timezone_short_name
        self.expire_date = expire_date
        self.fifty_day_average = fifty_day_average
        self.fifty_two_week_high = fifty_two_week_high
        self.fifty_two_week_low = fifty_two_week_low
        self.financial_currency = financial_currency
        self.five_year_average_return = five_year_average_return
        self.five_year_avg_dividend_yield = five_year_avg_dividend_yield
        self.float_shares = float_shares
        self.forward_eps = forward_eps
        self.forward_pe = forward_pe
        self.free_cashflow = free_cashflow
        self.from_currency = from_currency
        self.full_time_employees = full_time_employees
        self.fund_family = fund_family
        self.fund_inception_date = fund_inception_date
        self.gmt_off_set_milliseconds = gmt_off_set_milliseconds
        self.gross_margins = gross_margins
        self.gross_profits = gross_profits
        self.held_percent_insiders = held_percent_insiders
        self.held_percent_institutions = held_percent_institutions
        self.implied_shares_outstanding = implied_shares_outstanding
        self.industry = industry
        self.is_esg_populated = is_esg_populated
        self.last_cap_gain = last_cap_gain
        self.last_dividend_date = last_dividend_date
        self.last_dividend_value = last_dividend_value
        self.last_fiscal_year_end = last_fiscal_year_end
        self.last_market = last_market
        self.last_split_date = last_split_date
        self.last_split_factor = last_split_factor
        self.legal_type = legal_type
        self.logo_url = logo_url
        self.long_business_summary = long_business_summary
        self.long_name = long_name
        self.market = market
        self.market_cap = market_cap
        self.max_age = max_age
        self.max_supply = max_supply
        self.message_board_id = message_board_id
        self.morning_star_overall_rating = morning_star_overall_rating
        self.morning_star_risk_rating = morning_star_risk_rating
        self.most_recent_quarter = most_recent_quarter
        self.nav_price = nav_price
        self.net_income_to_common = net_income_to_common
        self.next_fiscal_year_end = next_fiscal_year_end
        self.number_of_analyst_opinions = number_of_analyst_opinions
        self.open = open
        self.open_interest = open_interest
        self.operating_cashflow = operating_cashflow
        self.operating_margins = operating_margins
        self.payout_ratio = payout_ratio
        self.peg_ratio = peg_ratio
        self.phone = phone
        self.previous_close = previous_close
        self.price_hint = price_hint
        self.price_to_book = price_to_book
        self.price_to_sales_trailing12_months = price_to_sales_trailing12_months
        self.profit_margins = profit_margins
        self.quick_ratio = quick_ratio
        self.quote_type = quote_type
        self.recommendation_key = recommendation_key
        self.recommendation_mean = recommendation_mean
        self.regular_market_day_high = regular_market_day_high
        self.regular_market_day_low = regular_market_day_low
        self.regular_market_open = regular_market_open
        self.regular_market_previous_close = regular_market_previous_close
        self.regular_market_price = regular_market_price
        self.regular_market_volume = regular_market_volume
        self.return_on_assets = return_on_assets
        self.return_on_equity = return_on_equity
        self.revenue_growth = revenue_growth
        self.revenue_per_share = revenue_per_share
        self.revenue_quarterly_growth = revenue_quarterly_growth
        self.sector = sector
        self.shares_outstanding = shares_outstanding
        self.shares_percent_shares_out = shares_percent_shares_out
        self.shares_short = shares_short
        self.shares_short_previous_month_date = shares_short_previous_month_date
        self.shares_short_prior_month = shares_short_prior_month
        self.short_name = short_name
        self.short_percent_of_float = short_percent_of_float
        self.short_ratio = short_ratio
        self.start_date = start_date
        self.state = state
        self.strike_price = strike_price
        self.symbol = symbol
        self.target_high_price = target_high_price
        self.target_low_price = target_low_price
        self.target_mean_price = target_mean_price
        self.target_median_price = target_median_price
        self.three_year_average_return = three_year_average_return
        self.to_currency = to_currency
        self.total_assets = total_assets
        self.total_cash = total_cash
        self.total_cash_per_share = total_cash_per_share
        self.total_debt = total_debt
        self.total_revenue = total_revenue
        self.tradeable = tradeable
        self.trailing_annual_dividend_rate = trailing_annual_dividend_rate
        self.trailing_annual_dividend_yield = trailing_annual_dividend_yield
        self.trailing_eps = trailing_eps
        self.trailing_pe = trailing_pe
        self.two_hundred_day_average = two_hundred_day_average
        self.volume = volume
        self.volume24_hr = volume24_hr
        self.volume_all_currencies = volume_all_currencies
        self.website = website
        self.symbol_yield = symbol_yield
        self.ytd_return = ytd_return
        self.zip = zip
